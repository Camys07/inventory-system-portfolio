<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Contact Us</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="styles.css">
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }
    
    body {
      display: flex;
      flex-direction: column;
      font-family: Arial, sans-serif;
      background: url('images/homepage_background.png') no-repeat center center fixed;
      background-size: cover;
    }
    
    main {
      flex: 1;
      padding: 20px;
    }
    footer {
      text-align: center;
      padding: 15px;
      background: linear-gradient(to right, #8806CE, #d6b4fc);
    }
    
    footer p {
      color: #fff;
    }
    /* Contact Form Styling */
    .contact-form {
      background: rgba(255,255,255,0.9);
      padding: 20px;
      max-width: 600px;
      margin: 20px auto;
      border-radius: 4px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    .contact-form form {
      display: flex;
      flex-direction: column;
    }
    .contact-form label {
      margin: 10px 0 5px;
      font-weight: bold;
    }
    .contact-form input, .contact-form textarea {
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 14px;
    }
    .contact-form button {
      margin-top: 15px;
      padding: 10px;
      background: linear-gradient(to right, #8806CE, #d6b4fc);
      color: #fff;
      border: none;
      border-radius: 4px;
      font-size: 16px;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    .contact-form button:hover {
      background: linear-gradient(to right, #d6b4fc, #8806CE);
    }
  </style>
</head>
<body>
  <!-- HEADER & NAVIGATION -->
  <header>
    <div class="navbar">
      <div class="navbar-left">
        <a href="index.html" class="logo">
          <img src="images/logo.png" alt="Lab Rat Experiment Logo">
          <span class="visually-hidden">Lab Rat Experiment</span>
        </a>
        <ul class="nav-list">
          <li><a href="index.html">Home</a></li>
        <li><a href="about-game.html">About Game</a></li>
        <li><a href="tutorial.html">Tutorial</a></li>
        <li id="leaderboard-link" class="hidden"><a href="leaderboard.html">Scoreboard</a></li>
        <li><a href="contact.html"  class="active">Contact Us</a></li>
        </ul>
      </div>
      <div class="navbar-right">
        <button id="account-button">Account ▼</button>
        <ul class="dropdown" id="account-dropdown">
          <li id="username-display" class="hidden"><span id="username"></span></li>
          <li id="profile-link" class="hidden"><a href="profile.html">Profile</a></li>
          <li id="logout-link" class="hidden"><a href="#" id="logout-button">Logout</a></li>
          <li id="login-link"><a href="login.html">Login</a></li>
          <li id="signup-link"><a href="register.html">Sign Up</a></li>
        </ul>
      </div>
    </div>
  </header>

  <!-- Contact Form -->
  <main>
    <section>
      <h1>Contact Us</h1>
      <div class="contact-form">
        <form id="contactForm">
          <label for="name">Name:</label>
          <input type="text" id="name" name="name" required>

          <label for="email">Email:</label>
          <input type="email" id="email" name="email" required readonly>

          <label for="message">Message:</label>
          <textarea id="message" name="message" rows="5" required></textarea>

          <button type="submit">Send Message</button>
        </form>
      </div>
    </section>
  </main>

  <footer>
    <p>&copy; 2025 Lab Rat Experiment. All rights reserved.</p>
  </footer>

  <!-- Include Firebase Compat Scripts -->
  <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-auth-compat.js"></script>

  <!-- Include the IIFE-based api.js -->
  <script src="api.js"></script>

  <!-- Firebase Initialization & Authentication -->
  <script>
    // Initialize Firebase using the compat libraries.
    const firebaseConfig = {
      apiKey: "AIzaSyB4nNmRWksPDQluiW2R1vi-RkWfPo9KUtI",
      authDomain: "lab-rat-experiment.firebaseapp.com",
      projectId: "lab-rat-experiment",
      storageBucket: "lab-rat-experiment.firebasestorage.app",
      messagingSenderId: "1005490252081",
      appId: "1:1005490252081:web:0b6ecb6f448f728f212810"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    // Listen for authentication state changes and update navigation accordingly.
    auth.onAuthStateChanged(function(user) {
      if (user) {
        console.log("User signed in:", user);
        // Pre-fill the email field.
        document.getElementById("email").value = user.email;
        // Derive a username (displayName or from the email).
        const username = user.displayName || (user.email ? user.email.split('@')[0] : "User");
        document.getElementById("account-button").textContent = username + " ▼";

        // Show authenticated-only links.
        document.getElementById("leaderboard-link").style.display = "block";
        document.getElementById("profile-link").style.display = "block";
        document.getElementById("logout-link").style.display = "block";

        // Hide non-authenticated actions.
        document.getElementById("login-link").style.display = "none";
        document.getElementById("signup-link").style.display = "none";
      } else {
        // If not signed in, hide authenticated-only links.
        document.getElementById("leaderboard-link").style.display = "none";
        document.getElementById("profile-link").style.display = "none";
        document.getElementById("logout-link").style.display = "none";

        // Show non-authenticated actions.
        document.getElementById("login-link").style.display = "block";
        document.getElementById("signup-link").style.display = "block";

        // Reset account button text.
        document.getElementById("account-button").textContent = "Account ▼";
      }
    });

    // Logout functionality.
    document.getElementById("logout-button")?.addEventListener("click", function(e) {
      e.preventDefault();
      auth.signOut()
        .then(function() { console.log("User signed out."); })
        .catch(function(error) { console.error("Error signing out:", error); });
    });
  </script>

  <!-- Account Dropdown Logic & Contact Form Submission (Using IIFE API) -->
  <script>
    document.addEventListener("DOMContentLoaded", function(){
      // Account Dropdown Toggle.
      const accountButton = document.getElementById("account-button");
      const accountDropdown = document.getElementById("account-dropdown");
      
      accountButton.addEventListener("click", function(e) {
        e.stopPropagation();
        accountDropdown.style.display = accountDropdown.style.display === "block" ? "none" : "block";
      });
      document.addEventListener("click", function() {
        accountDropdown.style.display = "none";
      });
      
      // Contact Form Submission using api.submitContactMessage().
      document.getElementById('contactForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const name = document.getElementById('name').value.trim();
        const email = document.getElementById('email').value.trim();
        const message = document.getElementById('message').value.trim();
  
        if (!name || !email || !message) {
          alert('Please fill in all fields.');
          return;
        }
  
        try {
          // Use the globally available api object from the IIFE.
          await api.submitContactMessage(name, email, message);
          alert("Message sent successfully!");
          document.getElementById('contactForm').reset();
        } catch (error) {
          console.error("Error submitting message:", error);
          alert("Error submitting message. Please try again.");
        }
      });
    });
  </script>
</body>
</html>
